<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Allocation Request</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"></script>
</head>
<body>
    <header>
        <div class="logo-image"></div> 
    </header>

    <main>
        <hr width="300px" size="2" color="#f89829">
        <h1 style="text-align: center;">Allocation Request</h1>
        <hr width="500px" size="2" color="#f89829">

        <div class="form-container" style="width: 1000px; margin: 0 auto; padding: 20px;">
            <form id="AllocationRequest" name="AllocationRequest">
                <div class="form-group">
                    <label for="requester">Requester:</label>
                    <input type="text" id="requester" name="requester">
                </div>
                <div class="form-group">
                    <label for="task">Task:</label>
                    <input type="text" id="task" name="task">
                </div>
                <div class="form-group">
                    <label for="additionnalInfo">Additional Information:</label>
                    <textarea id="additionnalInfo" name="additionnalInfo" rows="4" cols="50"></textarea>
                </div>
                <div class="form-group">
                    <label for="taRequested">Number of TA Requested:</label>
                    <input type="number" id="taRequested" name="taRequested" min="1" max="25">
                </div>
                <div class="form-group">
                    <label for="hoursRequested">Number of hours:</label>
                    <input type="number" id="hoursRequested" name="hoursRequested" min="1" max="8">
                </div>
                <div class="form-group">
                    <label for="from">From:</label>
                    <input type="text" id="from" name="from">
                </div>
                <div class="form-group">
                    <label for="to">To:</label>
                    <input type="text" id="to" name="to">
                </div>
                <div class="add-button-container">
                    <button type="button" class="button" onclick="addItem()">Add</button>
                    <br><br>
                    <div class="form-container" style="width: 800px; margin: 0 auto; padding: 20px;">
                        <h2>Confirmation Details</h2>
                        <table id="RequestConfirmation" style="margin: 0 auto;">
                            <thead>
                                <tr>
                                    <th>Requested By</th>
                                    <th>Date from</th>
                                    <th>Date to</th>
                                    <th>Task</th>
                                    <th>TA</th>
                                    <th>Hours</th>
                                    <th>Additional Info</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Rows will be added here dynamically -->
                            </tbody>
                        </table>
                        <div class="button-container">
                            <button type="button" class="button" onclick="sendEmail()">Confirm</button>
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </main>

    <footer>
        <p>&copy; 2024 Lionbridge Games. All rights reserved.</p>
    </footer>

    <script>
        $(function() {
            var dateFormat = "mm/dd/yy";
            $("#from, #to").datepicker({
                defaultDate: "+1w",
                changeMonth: true,
                numberOfMonths: 1,
                dateFormat: dateFormat
            }).on("change", function() {
                if (this.id === "from") {
                    $("#to").datepicker("option", "minDate", getDate(this));
                } else {
                    $("#from").datepicker("option", "maxDate", getDate(this));
                }
            });

            function getDate(element) {
                try {
                    return $.datepicker.parseDate(dateFormat, element.value);
                } catch (error) {
                    return null;
                }
            }
        });

        function addItem() {
            // Get form values
            var requester = $("#requester").val();
            var task = $("#task").val();
            var additionalInfo = $("#additionnalInfo").val();
            var taRequested = $("#taRequested").val();
            var hoursRequested = $("#hoursRequested").val();
            var from = $("#from").val();
            var to = $("#to").val();

            // Create new row for the table
            var newRow = `
                <tr>
                    <td>${requester}</td>
                    <td>${from}</td>
                    <td>${to}</td>
                    <td>${task}</td>
                    <td>${taRequested}</td>
                    <td>${hoursRequested}</td>
                    <td>${additionalInfo}</td>
                </tr>
            `;

            // Append the new row to the table
            $("#RequestConfirmation tbody").append(newRow);
        }

        async function sendEmail() {
            // Get form values
            var requester = $("#requester").val();
            var task = $("#task").val();
            var taRequested = $("#taRequested").val();
            var hoursRequested = $("#hoursRequested").val();
            var from = $("#from").val();
            var to = $("#to").val();
            var additionalInfo = $("#additionnalInfo").val();
            console.log("Form Values:", {
        requester, task, taRequested, hoursRequested, from, to, additionalInfo
    });

    // Check if any field is empty
    if (!requester || !task || !taRequested || !hoursRequested || !from || !to || !additionalInfo) {
        alert("Please fill in all the fields.");
        return;
    }
            try {
                // Replace with your actual Lambda/API endpoint for sending email
                const response = await fetch('https://d6lc96ph7c.execute-api.ca-central-1.amazonaws.com/prod/send-email', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'x-api-key': 'Nvqc4C0wiA4BBFoKpbAhD4y2kcs3ioew8ErzzQ39' // Your actual API key for sending email
                    },
                    body: JSON.stringify({
                        requester: requester,
                        task: task,
                        from: from,
                        to: to,
                        additionalInfo: additionalInfo
                    })
                });

                // Check if the response is okay
                if (!response.ok) {
                    throw new Error('Failed to send email');
                }

                // Show success message and redirect
                alert('Email sent successfully!');
                window.location.href = 'thankyou.html'; // Redirect to thankyou.html
            } catch (error) {
                // Handle errors
                alert('Error: ' + error.message);
            }
        }
    </script>
</body>
</html>
